# export previous_train_steps=10000
export PREVIOUS_MODEL_DIR="runwayml/stable-diffusion-v1-5"
# export PREVIOUS_MODEL_DIR="saved_models/${previous_train_steps}-step-model"
export MODEL_NAME="$PREVIOUS_MODEL_DIR"
export dataset_name="data_arrow_numeric_full/dataset_with_text_MERGED"
export new_train_steps=115000
export total_steps=$((new_train_steps + previous_train_steps))
export output_dir="saved_models/${total_steps}-step-model"

accelerate launch --mixed_precision="fp16"  train_SD.py \
  --pretrained_model_name_or_path=$MODEL_NAME \
  --dataset_name=$dataset_name \
  --resolution=512 \
  --train_batch_size=4 \
  --gradient_accumulation_steps=1 \
  --max_train_steps=$new_train_steps \
  --learning_rate=1e-5 \
  --max_grad_norm=1 \
  --lr_scheduler="constant" \
  --lr_warmup_steps=0 \
  --output_dir="$output_dir" \
  --center_crop \
  --checkpointing_steps=2000 \
  --validation_steps=500 \
  --checkpoints_total_limit=4 \
  --report_to="wandb" \
  --validation_prompts "[-0.010155955,-0.004592131,-0.38701367,-0.022426253,-0.00024568333,0.03570405,-0.025474727,-0.003766098,0.00015272689,-0.009874655,0.008434392,-0.012125211,-0.0005047297,0.03926266,-0.005911234,0.012074554,0.025061749,0.016118947,-0.025295403,0.0043429234,-0.019303171,-0.008965155,0.0048098783,-0.022155657,-0.018439487,0.012438098,-0.008230246,-0.011369854,0.013975238,-0.024733193,-0.0024420747,-0.007300651,-0.010927623,0.009804951,0.013800517,-0.010402694,-0.0024602013,0.010395709,-0.026068788,0.007702348,0.014202778,0.0013273212,0.010732115,0.011755251,-0.0026727943,-0.00014252868,-0.00964251,-0.01090727,-0.0086603165,0.91866994,0.0036692163,0.0012229425,0.012757576,-0.009995481,-0.019993355,0.01013756,0.024875883,0.008574486,-0.000510592,-0.013572663,0.0047257543,0.033691775,-0.004811735,-0.0038559795,-0.023267845,0.005499406,-0.19547385,0.021643838,0.007663427,0.01097489,0.02083284,0.0013352409,0.01342792,0.012294747,0.008467486,-0.014881456,0.0070831156,0.004481094,0.030578267,0.010763423,0.022135999,0.004610107,0.0061101215,-0.023164,-0.02054793,-0.01389838,0.012618901,0.0015867227,-0.0007768469,-0.025492975,-2.8981638,1.124453,0.0047108997,-0.0034027295,-0.012984973,-0.0029615848,0.015046431,0.0046694623,-0.009886998,-0.01942618,-0.009058119,0.014815218,0.0002879626,-0.0055417474,-0.0027186424,0.0059638117,0.0034492463,0.010449398,0.021700718,-0.0009963056,0.5486783,-0.014873964,-0.005197687,-0.00982392,0.015218205,0.0066417474,0.007279752,-0.0034043728,0.009700814,-0.014037486,-0.0048284503,-0.009108011,-0.0073809493,0.009162379,-0.024887985,0.003875365,0.0010573778,0.021624224]" "[-0.010155955,-0.004592131,-0.38701367,-0.022426253,-0.00024568333,0.03570405,-0.025474727,-0.003766098,0.00015272689,-0.009874655,0.008434392,-0.012125211,-0.0005047297,0.03926266,-0.005911234,0.012074554,0.025061749,0.016118947,-0.025295403,0.0043429234,-0.019303171,-0.008965155,0.0048098783,-0.022155657,-0.018439487,0.012438098,-0.008230246,-0.011369854,0.013975238,-0.024733193,-0.0024420747,-0.007300651,-0.010927623,0.009804951,0.013800517,-0.010402694,-0.0024602013,0.010395709,-0.026068788,0.007702348,0.014202778,0.0013273212,0.010732115,0.011755251,-0.0026727943,-0.00014252868,-0.00964251,-0.01090727,-0.0086603165,0.91866994,0.0036692163,0.0012229425,0.012757576,-0.009995481,-0.019993355,0.01013756,0.024875883,0.008574486,-0.000510592,-0.013572663,0.0047257543,0.033691775,-0.004811735,-0.0038559795,-0.023267845,0.005499406,-0.19547385,0.021643838,0.007663427,0.01097489,0.02083284,0.0013352409,0.01342792,0.012294747,0.008467486,-0.014881456,0.0070831156,0.004481094,0.030578267,0.010763423,0.022135999,0.004610107,0.0061101215,-0.023164,-0.02054793,-0.01389838,0.012618901,0.0015867227,-0.0007768469,-0.025492975,-2.8981638,1.124453,0.0047108997,-0.0034027295,-0.012984973,-0.0029615848,0.015046431,0.0046694623,-0.009886998,-0.01942618,-0.009058119,0.014815218,0.0002879626,-0.0055417474,-0.0027186424,0.0059638117,0.0034492463,0.010449398,0.021700718,-0.0009963056,0.5486783,-0.014873964,-0.005197687,-0.00982392,0.015218205,0.0066417474,0.007279752,-0.0034043728,0.009700814,-0.014037486,-0.0048284503,-0.009108011,-0.0073809493,0.009162379,-0.024887985,0.003875365,0.0010573778,0.021624224]" "[-0.026637983,-0.0049919384,-0.72735846,0.0013894774,1.663604e-6,-0.0037689628,-0.0007240372,0.011690616,0.011068916,0.035094958,0.0075723547,-0.020591881,0.014244843,0.015679605,0.0059791747,0.023565397,-2.31124e-5,0.007694515,-0.010229966,0.010043709,0.011308225,0.01125709,-0.00085738534,-0.0023815772,-0.0067716558,0.013232091,-0.020934608,0.0052047134,0.0031938986,-0.004571068,0.019595314,-0.014215741,0.017283715,0.0058534164,0.013672844,-0.008371335,-0.0011384739,-0.005467668,0.0069078547,-0.022255898,0.023867454,-0.008623882,-0.011428493,0.016150393,-0.010343215,0.009841408,0.0035812396,-0.0038042641,0.00046871044,-0.34486362,-0.04114393,-0.014105927,-0.006903317,0.005046356,0.008912971,0.024923684,-0.03211934,0.008048945,-0.0031226752,0.021200834,0.027791256,-0.012126264,-0.013014689,-0.010026319,-0.011552734,0.0023576792,0.6625984,-0.0037716748,-0.017448092,-0.003082925,0.0055787405,0.013155896,0.012592762,0.013704545,0.014140189,-0.034019794,0.008365242,0.0046707354,0.0045412,0.012962765,0.008882722,-0.0053416304,0.018359562,-0.013084315,0.00395564,-0.013893956,0.019868493,0.009645246,0.0083075445,0.01042995,3.8250873,-0.53500366,-0.0055012787,-0.00024795998,-0.025108527,0.0001758025,0.016005095,-0.014115073,-0.022973824,0.0007388084,-0.009637654,-0.0043257056,0.01392425,-0.007446825,-0.008244691,-0.01408944,-6.8385154e-5,-0.021611854,0.0012386662,-0.0153120095,1.1141413,-0.016341472,-0.0043792315,0.011762388,0.012778547,-0.021212585,-0.038239643,0.013913666,0.027715262,0.013375203,-0.00016425946,-0.04146558,0.00089889695,0.0057990993,0.010341369,0.02737344,-0.00036986242,0.014797182]" \
  --snr_gamma=5.0 \
  --noise_offset=0.1 \
  --use_ema \
  --validation_img_dir="../TemporalRetinaVAE/data/data_resized/validation_imgs_diffusion" \
  --validation_prompt_dir="../TemporalRetinaVAE/data/generate_images/generate_json_latent_test" \
  # --resume_from_checkpoint="latest" \
